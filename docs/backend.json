{
  "entities": {
    "Game": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Game",
      "type": "object",
      "description": "Represents a game available in the GameSphere store.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Game entity."
        },
        "title": {
          "type": "string",
          "description": "The title of the game."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the game."
        },
        "price": {
          "type": "number",
          "description": "The price of the game."
        },
        "releaseDate": {
          "type": "string",
          "description": "The date when the game was released.",
          "format": "date-time"
        },
        "genre": {
          "type": "string",
          "description": "The genre of the game (e.g., Action, RPG, Strategy)."
        },
        "developerId": {
          "type": "string",
          "description": "The ID of the developer user who submitted the game."
        },
        "publisher": {
          "type": "string",
          "description": "The publisher of the game."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the game's main image.",
          "format": "uri"
        },
        "trailerUrl": {
          "type": "string",
          "description": "URL of the game's trailer.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "price",
        "developerId",
        "imageUrl"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the GameSphere store.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "username": {
          "type": "string",
          "description": "The username of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "registrationDate": {
          "type": "string",
          "description": "The date when the user registered.",
          "format": "date-time"
        },
        "role": {
          "type": "string",
          "description": "The role of the user.",
          "enum": [
            "user",
            "dev",
            "admin"
          ]
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "registrationDate",
        "role"
      ]
    },
    "Review": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Review",
      "type": "object",
      "description": "Represents a user review for a game.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Review entity."
        },
        "gameId": {
          "type": "string",
          "description": "Reference to Game. (Relationship: Game 1:N Review)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Review)"
        },
        "rating": {
          "type": "number",
          "description": "The rating given by the user (e.g., 1 to 5 stars)."
        },
        "comment": {
          "type": "string",
          "description": "The text comment provided by the user."
        },
        "reviewDate": {
          "type": "string",
          "description": "The date when the review was submitted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "gameId",
        "userId",
        "rating",
        "comment",
        "reviewDate"
      ]
    },
    "ShoppingCart": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ShoppingCart",
      "type": "object",
      "description": "Represents the shopping cart for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ShoppingCart entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 ShoppingCart)"
        },
        "gameIds": {
          "type": "array",
          "description": "References to Games. (Relationship: ShoppingCart 1:N Game)",
          "items": {
            "type": "string"
          }
        },
        "createdDate": {
          "type": "string",
          "description": "The date when the shopping cart was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "gameIds",
        "createdDate"
      ]
    },
    "Wishlist": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Wishlist",
      "type": "object",
      "description": "Represents a user's wishlist of games.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Wishlist entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 Wishlist)"
        },
        "gameIds": {
          "type": "array",
          "description": "References to Games. (Relationship: Wishlist 1:N Game)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "gameIds"
      ]
    },
    "GameSubmission": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GameSubmission",
      "type": "object",
      "description": "A game submitted by a developer for review.",
      "properties": {
         "title": { "type": "string" },
         "description": { "type": "string" },
         "price": { "type": "number" },
         "genre": { "type": "string" },
         "imageUrl": { "type": "string", "format": "uri" },
         "developerId": { "type": "string" },
         "status": { "type": "string", "enum": ["pending", "approved", "rejected"] },
         "submittedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["title", "description", "price", "genre", "imageUrl", "developerId", "status", "submittedAt"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/games/{gameId}",
        "definition": {
          "entityName": "Game",
          "schema": {
            "$ref": "#/backend/entities/Game"
          },
          "description": "Stores approved, published games. Only admins can create documents here (by approving a submission).",
          "params": [
            {
              "name": "gameId",
              "description": "The unique identifier of the game."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information, including their role. Accessible only to the user, but roles can only be changed by admins.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/shopping_cart/{cartId}",
        "definition": {
          "entityName": "ShoppingCart",
          "schema": {
            "$ref": "#/backend/entities/ShoppingCart"
          },
          "description": "Stores shopping cart information for a user.  Accessible only to the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "cartId",
              "description": "The unique identifier of the shopping cart."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/wishlist/{wishlistId}",
        "definition": {
          "entityName": "Wishlist",
          "schema": {
            "$ref": "#/backend/entities/Wishlist"
          },
          "description": "Stores wishlist information for a user. Accessible only to the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "wishlistId",
              "description": "The unique identifier of the wishlist."
            }
          ]
        }
      },
      {
        "path": "/reviews/{reviewId}",
        "definition": {
          "entityName": "Review",
          "schema": {
            "$ref": "#/backend/entities/Review"
          },
          "description": "Stores user reviews for games. Requires 'userId' and 'gameId' to be present for security rules to validate ownership and enable listing reviews for a specific game.",
          "params": [
            {
              "name": "reviewId",
              "description": "The unique identifier of the review."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/library/{gameId}",
        "definition": {
          "entityName": "Game",
          "schema": {
            "$ref": "#/backend/entities/Game"
          },
          "description": "Stores purchased games for a user. Accessible only to the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "gameId",
              "description": "The unique identifier of the game."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/game_submissions/{gameSubId}",
        "definition": {
          "entityName": "GameSubmission",
          "schema": {
            "$ref": "#/backend/entities/GameSubmission"
          },
          "description": "Stores game submissions from a developer. Devs can create/update their own, admins can manage all.",
          "params": [
            { "name": "userId", "description": "The developer's user ID." },
            { "name": "gameSubId", "description": "The game submission's unique ID." }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure has been refactored to separate game submissions from the main game catalog, enhancing security and clarity. Game submissions are now stored in a subcollection under a developer's application, ensuring that only authorized developers can submit games and only admins can manage them. The main `/games` collection is now exclusively for published games, with creation rights restricted to admins who approve submissions. This prevents developers from writing directly to the public-facing game list, resolving previous permission issues."
  }
}